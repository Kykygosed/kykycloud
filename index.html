<script src="https://unpkg.com/three@0.159.0/examples/js/controls/OrbitControls.js"></script>

<script>
function log(msg){
  document.getElementById('debug').innerHTML += msg + '<br>';
}

var scene, camera, renderer, controls;

window.onload = function () {

  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x222222);

  camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 5000);
  camera.position.set(0, 2, 5);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff, 0.6));
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5,10,5);
  scene.add(light);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.05;
  controls.enableZoom = true;

  log('ScÃ¨ne prÃªte');

  var loader = new THREE.GLTFLoader();

  loader.load(
    './plane.glb',
    function (gltf) {

      var model = gltf.scene;

      // ðŸ”¹ Calcul de la bounding box
      var box = new THREE.Box3().setFromObject(model);
      var size = box.getSize(new THREE.Vector3()).length();
      var center = box.getCenter(new THREE.Vector3());

      // ðŸ”¹ Recentrage
      model.position.sub(center);

      // ðŸ”¹ Mise Ã  lâ€™Ã©chelle automatique
      var scale = 5 / size;
      model.scale.setScalar(scale);

      scene.add(model);

      // ðŸ”¹ Ajustement camÃ©ra
      camera.near = size / 100;
      camera.far = size * 100;
      camera.updateProjectionMatrix();

      camera.position.set(0, size * 0.2, size * 1.2);
      controls.target.set(0, 0, 0);
      controls.update();

      log('ModÃ¨le affichÃ© correctement');
    },
    undefined,
    function (e) {
      log('ERREUR GLB');
      log(e.message || e);
    }
  );

  animate();
};

function animate() {
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
}

window.addEventListener('resize', () => {
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>
